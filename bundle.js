(()=>{"use strict";class e{constructor(e){this.emitter=e,this.tableStyle="score",this.data,this.tableHead=document.querySelector(".table__head"),this.dataRows=document.querySelectorAll(".data-row"),this.buildTable=this.buildTable.bind(this),this.filter=this.filter.bind(this),this.setTableDisplay=this.setTableDisplay.bind(this),this.reset=this.reset.bind(this)}buildHead(e){const t=document.createDocumentFragment();for(const s of e.headers){const e=document.createElement("th");e.innerText=`${s}`,t.appendChild(e)}console.log(this.tableHead.querySelector(".top-row")),this.tableHead.querySelector(".top-row").children[1].setAttribute("colspan",e.headers.length),this.tableHead.querySelector(".labels").appendChild(t)}buildTable(t){this.data=e.calculateChange(t),console.log(this.data),this.buildHead(this.data);[...document.querySelectorAll(".category-row")].map((e=>e.children[0].setAttribute("colspan",this.data.data[0].length+1)));for(let t=0;t<this.data.data.length;t++){const s=this.data.data[t],i=this.dataRows[t],a=s.shift(),n=document.createElement("td");n.innerText=a.substring(0,40),i.appendChild(n);for(const t of s){const s=document.createElement("td");s.setAttribute("data-score",t[0]),s.setAttribute("data-change",t[1]),s.classList.add(e.setBackground(t[0])),i.appendChild(s)}}}static calculateChange(e){const t=e.data.map((e=>e.map(((e,t,s)=>0==t?e:1==t?[e,0]:[e,s[t]-s[t-1]]))));return{headers:e.headers,data:t}}filter(t){this.reset();const s=e.setPair(t.imr),i=this.data.data.map((e=>e.filter(((e,t)=>-1!=s.indexOf(t))))).map((e=>e.reduce(((e,t)=>t[0]-e[0]))));for(let e=0;e<i.length;e++)"increase"==t.compliance&&i[e]<1&&this.dataRows[e].classList.add("data-row--hidden"),"decrease"==t.compliance&&i[e]>=0&&this.dataRows[e].classList.add("data-row--hidden"),"change"==t.compliance&&0==i[e]&&this.dataRows[e].classList.add("data-row--hidden")}reset(){for(const e of this.dataRows)e.classList.remove("data-row--hidden")}setTableDisplay(t){if(t!=this.tableStyle){this.tableStyle=t;for(const t of this.dataRows)for(let i=1;i<t.children.length;i++){const a=t.children[i];for(var s=a.classList;s.length>0;)s.remove(s.item(0));if("score"==this.tableStyle){const t=a.getAttribute("data-score");a.classList.add(e.setChangeBackground(t))}if("change"==this.tableStyle){const t=a.getAttribute("data-change");a.classList.add(e.setChangeBackground(t))}}}}static setPair(e){let t=[];return t=e>=8?[e-3,e-2]:[e-2,e-1],t}static setChangeBackground(e){let t="no-change";return 1==e&&(t="increase-one"),2==e&&(t="increase-two"),3==e&&(t="increase-three"),-1==e&&(t="decrease-one"),-2==e&&(t="decrease-two"),-3==e&&(t="decrease-three"),t}static setBackground(e){let t="non-compliant";return 1==e&&(t="primary-compliance"),2==e&&(t="secondary-compliance"),3==e&&(t="operational-compliance"),t}}class t{constructor(e,t){this.emitter=e,this.elem=t,this.onClick=this.onClick.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(e){this.emitter.emit("set-table-style",e.target.value)}}class s{constructor(e){this.emitter=e,this.elem=document.querySelector(".js-clear-btn"),this.onClick=this.onClick.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(){this.emitter.emit("clear")}}class i{constructor(e,t){this.emitter=e,this.elem=t,this.onClick=this.onClick.bind(this),this.clear=this.clear.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(e){this.emitter.emit("set-filter",e.target.value)}clear(){this.elem.checked&&(this.elem.checked=!1)}}class a{constructor(e){this.elem=document.querySelector(".js-imr-select"),this.emitter=e,this.onChange=this.onChange.bind(this),this.clear=this.clear.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}buildOptions(e){const t=document.createDocumentFragment();for(const s of e){const e=document.createElement("option");e.innerText=`IMR-${s}`,e.value=s,t.appendChild(e)}this.elem.appendChild(t)}addEventListeners(){this.elem.addEventListener("change",this.onChange)}onChange(e){this.emitter.emit("set-imr-value",e.target.value)}clear(){this.elem.value="placeholder"}}class n{constructor(e){this.elem=document.querySelector(".js-filter-btn"),this.filters={},this.emitter=e,this.active=!1,this.onClick=this.onClick.bind(this),this.setImr=this.setImr.bind(this),this.setActive=this.setActive.bind(this),this.clear=this.clear.bind(this),this.checkFilters=this.checkFilters.bind(this),this.setComplianceChange=this.setComplianceChange.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}setImr(e){this.filters.imr=e,this.checkFilters()}setComplianceChange(e){this.filters.compliance=e,this.checkFilters()}checkFilters(){this.filters.hasOwnProperty("compliance")&&this.filters.hasOwnProperty("imr")&&this.setActive(!0)}clear(){this.filters={},this.setActive(!1)}setActive(e){this.active=e,this.active?(this.elem.classList.add("filter-btn--active"),this.elem.disabled=!1):(this.elem.classList.remove("filter-btn--active"),this.elem.disabled=!0)}onClick(){this.emitter.emit("filter",this.filters)}}const c=function(e){const t=document.querySelectorAll(".js-score-legend-item"),s=document.querySelectorAll(".js-change-legend-item");if("change"==e){for(const e of s)e.classList.remove("legend-item--hidden");for(const e of t)e.classList.add("legend-item--hidden")}else if("score"==e){for(const e of t)e.classList.remove("legend-item--hidden");for(const e of s)e.classList.add("legend-item--hidden")}};(async()=>{const l={all:r=r||new Map,on:function(e,t){var s=r.get(e);s&&s.push(t)||r.set(e,[t])},off:function(e,t){var s=r.get(e);s&&s.splice(s.indexOf(t)>>>0,1)},emit:function(e,t){(r.get(e)||[]).slice().map((function(e){e(t)})),(r.get("*")||[]).slice().map((function(s){s(e,t)}))}};var r;const d=new e(l),h=new a(l),o=document.querySelectorAll(".js-compliance-change-radio"),m=new i(l,o[0]),u=new i(l,o[1]),b=new i(l,o[2]);new s(l);const f=new n(l);document.querySelectorAll(".js-table-display-radio").forEach((e=>new t(l,e))),l.on("set-imr-value",f.setImr),l.on("set-filter",f.setComplianceChange),l.on("filter",d.filter),l.on("clear",f.clear),l.on("clear",u.clear),l.on("clear",m.clear),l.on("clear",b.clear),l.on("clear",h.clear),l.on("clear",d.reset),l.on("set-table-style",d.setTableDisplay),l.on("set-table-style",c),fetch("./data.json").then((e=>e.json())).then((e=>{d.buildTable(e);const t=[...e.headers.slice(1)];h.buildOptions(t)}))})()})();