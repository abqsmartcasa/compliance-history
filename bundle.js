(()=>{"use strict";class e{constructor(e){this.emitter=e,this.tableStyle="score",this.data,this.tableHead=document.querySelector(".table__head"),this.dataRows=document.querySelectorAll(".data-row"),this.categoryRows=document.querySelectorAll(".category-row"),this.buildTable=this.buildTable.bind(this),this.filter=this.filter.bind(this),this.setTableDisplay=this.setTableDisplay.bind(this),this.hideCategoryRows=this.hideCategoryRows.bind(this),this.reset=this.reset.bind(this)}buildHead(e){const t=document.createDocumentFragment();for(const s of e.headers){const e=document.createElement("th");e.innerText=`${s}`,t.appendChild(e)}this.tableHead.querySelector(".top-row").children[1].setAttribute("colspan",e.headers.length-1),this.tableHead.querySelector(".top-row").children[1].style.width=25*(e.headers.length-1)+"px",this.tableHead.querySelector(".labels").appendChild(t)}buildTable(t){this.data=e.calculateChange(t),this.buildHead(this.data);[...document.querySelectorAll(".category-row")].map((e=>e.children[0].setAttribute("colspan",this.data.data[0].length)));for(let t=0;t<this.data.data.length;t++){const i=this.data.data[t],n=this.dataRows[t],a=i.shift(),o=a.split(" - ")[0],r=a.split(" - ")[1],l=document.createElement("span");l.innerText=` - ${r}`,l.classList.add("paragraph-description");const c=document.createElement("td");c.classList.add("paragraph-title"),c.innerText=o,c.appendChild(l),n.appendChild(c);for(const t of i){const i=document.createElement("td");i.setAttribute("data-score",t[0]),i.setAttribute("data-change",t[1]),i.classList.add(e.setBackground(t[0])),new s(i,this.emitter),n.appendChild(i)}}}static calculateChange(e){const t=e.data.map((e=>e.map(((e,t,s)=>0==t?e:1==t?[e,0]:[e,s[t]-s[t-1]]))));return{headers:e.headers,data:t}}filter(t){this.reset();const s=e.setPair(t.imr),i=this.data.data.map((e=>e.filter(((e,t)=>-1!=s.indexOf(t))))).map((e=>e.reduce(((e,t)=>t[0]-e[0]))));for(let e=0;e<i.length;e++)"increase"==t.compliance&&i[e]<1&&this.dataRows[e].classList.add("data-row--hidden"),"decrease"==t.compliance&&i[e]>=0&&this.dataRows[e].classList.add("data-row--hidden"),"change"==t.compliance&&0==i[e]&&this.dataRows[e].classList.add("data-row--hidden");this.hideCategoryRows()}reset(){for(const e of this.dataRows)e.classList.remove("data-row--hidden");for(const e of this.categoryRows)e.classList.remove("category-row--hidden")}setTableDisplay(t){if(t!=this.tableStyle){this.tableStyle=t;for(const t of this.dataRows)for(let i=1;i<t.children.length;i++){const n=t.children[i];for(var s=n.classList;s.length>0;)s.remove(s.item(0));if("score"==this.tableStyle){const t=n.getAttribute("data-score");n.classList.add(e.setChangeBackground(t))}if("change"==this.tableStyle){const t=n.getAttribute("data-change");n.classList.add(e.setChangeBackground(t))}}}}hideCategoryRows(){for(let e=0;e<this.categoryRows.length;e++){const t=i(this.categoryRows[e],this.categoryRows[e+1]);let s=!1;for(const e of t)if(!e.classList.contains("data-row--hidden")){s=!0;break}s||this.categoryRows[e].classList.add("category-row--hidden")}}static setPair(e){let t=[];return t=e>=8?[e-3,e-2]:[e-2,e-1],t}static setChangeBackground(e){let t="no-change";return 1==e&&(t="increase-one"),2==e&&(t="increase-two"),3==e&&(t="increase-three"),-1==e&&(t="decrease-one"),-2==e&&(t="decrease-two"),-3==e&&(t="decrease-three"),t}static setBackground(e){let t="non-compliant";return 1==e&&(t="primary-compliance"),2==e&&(t="secondary-compliance"),3==e&&(t="operational-compliance"),t}}class t{constructor(e,t){this.emitter=e,this.elem=t,this.onClick=this.onClick.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(e){this.emitter.emit("set-table-style",e.target.value)}}class s{constructor(e,t){this.elem=e,this.emitter=t,this.score=this.elem.getAttribute("data-score"),this.change=this.elem.getAttribute("data-change"),this.showValue=this.showValue.bind(this),this.removeValue=this.removeValue.bind(this),this.mouserEnter=this.mouserEnter.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("mouseenter",this.mouserEnter),this.elem.addEventListener("mouseleave",this.removeValue)}mouserEnter(){this.elem.addEventListener("mousemove",this.showValue)}showValue(e){const t={pageX:e.pageX,pageY:e.pageY,score:this.score,change:this.change};this.emitter.emit("show-value",t)}removeValue(){this.emitter.emit("remove-value"),this.elem.removeEventListener("mousemove",this.mouseMove)}}function i(e,t){var s=[];for(e=e.nextElementSibling;e&&e!=t;)s.push(e),e=e.nextElementSibling;return s}class n{constructor(e){this.emitter=e,this.elem=document.querySelector(".js-clear-btn"),this.onClick=this.onClick.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(){this.emitter.emit("clear")}}class a{constructor(e,t){this.emitter=e,this.elem=t,this.onClick=this.onClick.bind(this),this.clear=this.clear.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}onClick(e){this.emitter.emit("set-filter",e.target.value)}clear(){this.elem.checked&&(this.elem.checked=!1)}}class o{constructor(e){this.elem=document.querySelector(".js-imr-select"),this.emitter=e,this.onChange=this.onChange.bind(this),this.clear=this.clear.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}buildOptions(e){const t=document.createDocumentFragment();for(const s of e){const e=document.createElement("option");e.innerText=`IMR-${s}`,e.value=s,t.appendChild(e)}this.elem.appendChild(t)}addEventListeners(){this.elem.addEventListener("change",this.onChange)}onChange(e){this.emitter.emit("set-imr-value",e.target.value)}clear(){this.elem.value="placeholder"}}class r{constructor(e){this.elem=document.querySelector(".js-filter-btn"),this.filters={},this.emitter=e,this.active=!1,this.onClick=this.onClick.bind(this),this.setImr=this.setImr.bind(this),this.setActive=this.setActive.bind(this),this.clear=this.clear.bind(this),this.checkFilters=this.checkFilters.bind(this),this.setComplianceChange=this.setComplianceChange.bind(this),this.addEventListeners=this.addEventListeners.bind(this),this.addEventListeners()}addEventListeners(){this.elem.addEventListener("click",this.onClick)}setImr(e){this.filters.imr=e,this.checkFilters()}setComplianceChange(e){this.filters.compliance=e,this.checkFilters()}checkFilters(){this.filters.hasOwnProperty("compliance")&&this.filters.hasOwnProperty("imr")&&this.setActive(!0)}clear(){this.filters={},this.setActive(!1)}setActive(e){this.active=e,this.active?(this.elem.classList.add("filter-btn--active"),this.elem.disabled=!1):(this.elem.classList.remove("filter-btn--active"),this.elem.disabled=!0)}onClick(){this.emitter.emit("filter",this.filters)}}const l={0:"Non-compliance",1:"Primary compliance",2:"Secondary compliance",3:"Operational compliance"},c={"-3":"Decreased by three levels","-2":"Decreased by two levels","-1":"Decreased by one level",0:"No change",1:"Increased by one level",2:"Increased by two levels",3:"Increased by three levels"};const h=class{constructor(){this.elem=document.querySelector(".js-tooltip"),this.body=document.querySelector(".js-tooltip__body"),this.lookup=l,this.timeout,this.setLookup=this.setLookup.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this)}setLookup(e){this.lookup="change"==e?c:l}show(e){const t=window.innerWidth;this.elem.classList.remove("tooltip--hidden");const s=this.lookup==c?e.change:e.score,i=this.lookup[s];this.body.innerText=i;const{height:n}=window.getComputedStyle(this.body);this.elem.style.right=t-e.pageX+5+"px",this.elem.style.top=e.pageY-parseInt(n)-10+"px"}hide(){this.elem.classList.add("tooltip--hidden")}};const d=function(e){const t=document.querySelectorAll(".js-score-legend-item"),s=document.querySelectorAll(".js-change-legend-item");if("change"==e){for(const e of s)e.classList.remove("legend-item--hidden");for(const e of t)e.classList.add("legend-item--hidden")}else if("score"==e){for(const e of t)e.classList.remove("legend-item--hidden");for(const e of s)e.classList.add("legend-item--hidden")}};(async()=>{const s={all:i=i||new Map,on:function(e,t){var s=i.get(e);s&&s.push(t)||i.set(e,[t])},off:function(e,t){var s=i.get(e);s&&s.splice(s.indexOf(t)>>>0,1)},emit:function(e,t){(i.get(e)||[]).slice().map((function(e){e(t)})),(i.get("*")||[]).slice().map((function(s){s(e,t)}))}};var i;const l=new e(s),c=new o(s),m=document.querySelectorAll(".js-compliance-change-radio"),u=new a(s,m[0]),p=new a(s,m[1]),g=new a(s,m[2]);new n(s);const b=new h,v=new r(s);document.querySelectorAll(".js-table-display-radio").forEach((e=>new t(s,e))),s.on("set-imr-value",v.setImr),s.on("set-filter",v.setComplianceChange),s.on("show-value",b.show),s.on("remove-value",b.hide),s.on("filter",l.filter),s.on("clear",v.clear),s.on("clear",p.clear),s.on("clear",u.clear),s.on("clear",g.clear),s.on("clear",c.clear),s.on("clear",l.reset),s.on("set-table-style",l.setTableDisplay),s.on("set-table-style",d),s.on("set-table-style",b.setLookup),fetch("./data.json").then((e=>e.json())).then((e=>{l.buildTable(e);const t=[...e.headers.slice(1)];c.buildOptions(t)}))})()})();